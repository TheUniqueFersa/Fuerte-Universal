**********************************
*PROGRAMA DE PUERTO SERIAL
**********************************
**********************************
*DECLARACION DE CONSTANTES
**********************************

PORTD  EQU   $1008
DDRD   EQU   $1009

SCDR   EQU   $102F
SCCR2  EQU   $102D
SCSR   EQU   $102E
SCCR1  EQU   $102C
BAUD   EQU   $102B
HPRIO  EQU   $103C

**********************************
*DECLARACION DE VARIABLES
**********************************
ORDEN  EQU   $0000
VAR    EQU   $0001

**********************************
*PROGRAMA PRINCIPAL
**********************************

       ORG   $8000   * DIR DE INICIO
       LDS   #$00FF  * APUNTADOR DE STAK
       JSR   CONFIGURA
       CLR ORDEN

OTRO
       CLR   VAR

LOOP
        LDAA  ORDEN
        CMPA  #'K
        BNE   OTRO
    
        LDAA  VAR
        BEQ   LOOP

HHHH
       LDX   #SCSR 
       LDAA  SCSR
       LDAA  #'H                 
       STAA  SCDR
CR1
       BRCLR $00,X,#$80 CR1

OOOO
       LDX   #SCSR 
       LDAA  SCSR
       LDAA  #'O                 
       STAA  SCDR
CR2
       BRCLR $00,X,#$80 CR2  

LLLL
       LDX   #SCSR 
       LDAA  SCSR
       LDAA  #'L                 
       STAA  SCDR
CR3
       BRCLR $00,X,#$80 CR3         

AAAA
       LDX   #SCSR 
       LDAA  SCSR
       LDAA  #'A                 
       STAA  SCDR
CR4
       BRCLR $00,X,#$80 CR4
     
JMP    OTRO
 

CONFIGURA
       LDD   #$302C  * CONFIGURA PUERTO SERIAL
       STAA  BAUD    * BAUD  9600  para cristal de 8MHz
       STAB  SCCR2   * HABILITA  RX Y TX PERO INTERRUPCN SOLO RX
       LDAA  #$00
       STAA  SCCR1   * 8 BITS

       LDAA  #$FE    * CONFIG PUERTO D COMO SALIDAS (EXCEPTO PD0)
       STAA  DDRD    * SEA  ENABLE DEL DISPLAY  PD4  Y RS PD3
                     
      
       LDAA  #$04
       STAA  HPRIO

       LDAA  #$00
       TAP


         RTS



***********************************
* ATENCION A INTERRUPCION SERIAL
***********************************
       ORG  $F100
       LDAA SCSR
       LDAA SCDR
       STAA ORDEN
       DEC  VAR
        
       RTI

***********************************
* VECTOR INTERRUPCION SERIAL
***********************************
       ORG   $FFD6
       FCB   $F1,$00  

***********************************
*RESET
***********************************
       ORG    $FFFE
RESET  FCB    $80,$00
***********************************
       END   $8000
  


